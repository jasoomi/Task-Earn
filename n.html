<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task-Earn</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* --- KEEP ALL YOUR EXISTING STYLES EXACTLY AS IS --- */
body {margin:0;font-family:Arial,sans-serif;background:#f0f2f5;display:flex;flex-direction:column;min-height:100vh}
header{background:white;color:#764ba2;padding:20px;text-align:center;font-size:24px;font-weight:bold;border-radius:0 0 15px 15px;box-shadow:0 4px 15px rgba(0,0,0,0.2);margin:10px;position:sticky;top:0;z-index:100}
#mainContent{flex:1;padding:20px;text-align:center}
.bottom-nav{display:flex;justify-content:space-around;background:white;padding:15px;border-radius:20px 20px 0 0;box-shadow:0 -4px 15px rgba(0,0,0,0.2);margin:0 10px 15px 10;position:sticky;bottom:0;z-index:100}
.nav-item{text-align:center;color:#888;font-size:20px;cursor:pointer;transition:0.3s}
.nav-item.active{color:#764ba2;transform:scale(1.2)}
#profilePopup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:15px;box-shadow:0 6px 20px rgba(0,0,0,0.3);width:90%;max-width:400px;z-index:1000;text-align:left}
#profilePopup input,#profilePopup select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc}
#profilePopup button{background:#764ba2;color:white;padding:10px;border:none;border-radius:8px;cursor:pointer;width:100%}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;width:100%}
.card{background:white;color:#333;padding:20px;border-radius:15px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.2);transition:transform 0.3s ease,box-shadow 0.3s ease}
.card:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 10px 25px rgba(0,0,0,0.3)}
.card h3{margin-bottom:10px;color:#764ba2}
.card p{font-size:18px;font-weight:bold}
.withdraw-form{max-width:400px;margin:auto;text-align:left}
.withdraw-form input,.withdraw-form select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc}
.withdraw-form button{background:#764ba2;color:white;padding:12px;border:none;border-radius:8px;cursor:pointer;width:100%;margin-top:10px}
.withdraw-form button:disabled{background:#aaa;cursor:not-allowed}
.task-cards{display:flex;gap:20px;overflow-x:auto;padding:10px;scroll-behavior:smooth;padding-bottom:20px}
.task-card{flex:0 0 250px;min-width:250px;height:250px;background:white;color:#333;border-radius:15px;padding:10px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.2);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;font-size:16px;font-weight:bold;cursor:pointer;transition:0.3s}
.task-card.completed{background:#d4edda;color:#155724;cursor:default}
.task-card img{width:100%;border-radius:10px;margin-bottom:5px}
.task-card span{text-align:center}
.profile-detail-card{background:white;color:#333;padding:15px;border-radius:15px;text-align:left;box-shadow:0 6px 20px rgba(0,0,0,0.2);margin:10px 0;font-size:14px}
.level-card{background:white;color:#333;padding:15px;border-radius:15px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.2);margin:10px 0;font-size:14px}
.level-bar{background:#ddd;border-radius:10px;overflow:hidden;height:20px;margin-top:10px}
.level-progress{height:100%;background:#764ba2;width:0%;text-align:right;padding-right:5px;color:white;font-weight:bold;line-height:20px;transition:width 1s ease}
#levelUpBanner{position:fixed;top:-100px;left:50%;transform:translateX(-50%);background:gold;color:black;font-size:20px;padding:10px 20px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.3);z-index:2000;transition:top 0.5s ease}
</style>
</head>
<body>
<header>Welcome to Task-Earn</header>
<div id="mainContent">Home</div>
<div id="levelUpBanner">üéâ Congratulations! Level Up! üëè</div>

<!-- Profile Popup -->
<div id="profilePopup">
  <h2>Complete Profile</h2>
  <input type="text" id="firstName" placeholder="First Name">
  <input type="text" id="lastName" placeholder="Last Name">
  <input type="number" id="age" placeholder="Age">
  <input type="text" id="city" placeholder="City">
  <input type="email" id="email" placeholder="Email">
  <select id="withdrawMethod">
    <option value="">Select Withdraw Method</option>
    <option value="Easypaisa">Easypaisa</option>
    <option value="JazzCash">JazzCash</option>
  </select>
  <button onclick="saveProfile()">Save</button>
</div>

<div class="bottom-nav">
  <div class="nav-item" onclick="openProfile(this)"><i class="fa-solid fa-user"></i></div>
  <div class="nav-item" onclick="showContent('tasks', this)"><i class="fa-solid fa-list-check"></i></div>
  <div class="nav-item" onclick="showContent('earnings', this)"><i class="fa-solid fa-wallet"></i></div>
  <div class="nav-item" onclick="showContent('withdraw', this)"><i class="fa-solid fa-money-bill-transfer"></i></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- GLOBAL VARIABLES ---
let profileData = {}, profileSaved = false, userXP = 0, currentLevel = 1;
let completedTasks = [], totalEarnings = 0, totalWithdraw = 0;

// --- UTILITY FUNCTIONS ---
function showLevelUpBanner(){const banner=document.getElementById("levelUpBanner");banner.style.top="20px";setTimeout(()=>banner.style.top="-100px",2000);}
function updateXPBar(){const p=document.getElementById("levelProgress");if(!p)return;const perc=Math.min((userXP/400)*100,100);p.style.width=perc+"%";p.textContent=userXP;}
function renderProfileDetails(){document.getElementById("mainContent").innerHTML=`
<div class="profile-detail-card">
<p><strong>Name:</strong>${profileData.name}</p>
<p><strong>Email:</strong>${profileData.email}</p>
<p><strong>Age:</strong>${profileData.age}</p>
<p><strong>City:</strong>${profileData.city}</p>
<p><strong>Withdraw Method:</strong>${profileData.method}</p>
</div>
<div class="level-card">
<h3>Level ${currentLevel}</h3>
<p>XP: ${userXP} / 400</p>
<div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
</div>`;updateXPBar();}

// --- TAB FUNCTION ---
function showContent(tab, element){
  document.querySelectorAll(".nav-item").forEach(item=>item.classList.remove("active"));
  if(element) element.classList.add("active");
  document.getElementById("profilePopup").style.display="none";

  if(tab==="earnings"){
    document.getElementById("mainContent").innerHTML=`<div class="cards">
    <div class="card"><h3>üìÖ Today Earnings</h3><p>${totalEarnings} PKR</p></div>
    <div class="card"><h3>üí∞ Total Earnings</h3><p>${totalEarnings} PKR</p></div>
    <div class="card"><h3>‚úÖ Tasks Completed</h3><p>${completedTasks.length}</p></div>
    <div class="card"><h3>üè¶ Total Withdrawals</h3><p>${totalWithdraw} PKR</p></div></div>`;
  } else if(tab==="withdraw"){
    document.getElementById("mainContent").innerHTML=`<div class="withdraw-form">
    <h2>Withdraw Funds</h2>
    <input type="text" value="${profileData.name||''}" placeholder="Username" readonly>
    <input type="email" value="${profileData.email||''}" placeholder="Email" readonly>
    <input type="number" id="withdrawAmount" placeholder="Amount (Min 300)">
    <input type="text" id="accountName" placeholder="Account Name">
    <input type="text" id="accountNumber" placeholder="Account Number">
    <select id="paymentMethod">
    <option value="">Select Payment Method</option>
    <option value="Easypaisa">Easypaisa</option>
    <option value="JazzCash">JazzCash</option>
    </select>
    <button onclick="processWithdraw()">Withdraw</button>
    <button onclick="lastWithdraw()">Last Withdraw</button></div>`;
  } else if(tab==="tasks"){
    if(!profileSaved){alert("‚ö†Ô∏è Complete profile first!"); return;}
    const main=document.getElementById("mainContent");
    main.innerHTML='<div class="task-cards" id="taskCardsContainer">Loading tasks...</div>';
    db.collection("tasks").get().then(snap=>{
      let html='';
      snap.forEach(doc=>{
        const t=doc.data(),id=doc.id;
        const completed=completedTasks.includes(id)?'completed':'';
        const text=completed?`‚úÖ ${t.title} Completed`:t.title;
        html+=`<div class="task-card ${completed}" id="${id}" onclick="watchVideoTask('${id}','${t.videoUrl}',30)">
        <img src="${t.thumbnail}"><span>${text}</span></div>`;
      });
      document.getElementById("taskCardsContainer").innerHTML=html;
    });
  } else if(tab==="profile"){profileSaved?renderProfileDetails():document.getElementById("profilePopup").style.display="block";}
  else document.getElementById("mainContent").innerText=tab;
}
function openProfile(el){showContent('profile',el);}

// --- PROFILE SAVE ---
function saveProfile(){
  const f=document.getElementById("firstName").value.trim(),
        l=document.getElementById("lastName").value.trim(),
        a=document.getElementById("age").value.trim(),
        c=document.getElementById("city").value.trim(),
        e=document.getElementById("email").value.trim(),
        m=document.getElementById("withdrawMethod").value;
  if(!f||!l||!a||!c||!e||!m){alert("‚ö†Ô∏è Fill all profile fields.");return;}
  const pat=/^[a-zA-Z0-9._%+-]+@gmail\.com$/;
  if(!pat.test(e)){alert("‚ö†Ô∏è Enter valid Gmail.");return;}
  profileData={name:f+' '+l,age:a,city:c,email:e,method:m};profileSaved=true;renderProfileDetails();document.getElementById("profilePopup").style.display="none";
}

// --- TASK VIDEO WATCH ---
function watchVideoTask(taskId,url,duration){
  if(completedTasks.includes(taskId)){alert("‚úÖ Already completed!");return;}
  const w=window.open(url,'_blank');alert("Watch the video for at least 30 seconds, then return and click OK to claim reward.");
  completedTasks.push(taskId);
  userXP+=30;totalEarnings+=50; // reward
  if(userXP>=400){currentLevel++;showLevelUpBanner();}
  alert("‚úÖ Task reward added!");
  showContent('tasks');
}

// --- WITHDRAW ---
function processWithdraw(){
  const amt=document.getElementById("withdrawAmount").value;
  if(amt<300){alert("Min withdrawal 300 PKR");return;}
  totalWithdraw+=parseInt(amt);
  totalEarnings-=parseInt(amt);
  alert(`‚úÖ Withdrawal of ${amt} PKR approved.`);
  showContent('withdraw');
}
function lastWithdraw(){alert(`üìå Last withdrawal: ${totalWithdraw} PKR`);}
</script>
</body>
</html>